---
title: "Rustã§Exifã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚“ã§è¦‹ã‚‹"
layout: posts.liquid
is_draft: false
published_date: 2018-12-23 03:40:47 +0900
categories: ["TECHNOLOGY"]
tags: []
---

### æ¦‚è¦
Rustã§Exifã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚“ã§è¦‹ã‚‹ã€‚RustãŒå…¨ç„¶ã‹ã‘ãªã„ã®ã§ã€ã¨ã‚Šã‚ãˆãšãŒã‚€ã—ã‚ƒã‚‰ã«ã‚„ã£ã¦è¦‹ã‚‹ã€‚ã§ã™ã€‚ä½œæ¥­ãƒ¡ãƒ¢ã€‚

### æº–å‚™
Exifã‚’èª­ã‚€ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¢ã—ãŸã¨ã“ã‚ä»¥ä¸‹ã®ã‚‚ã®ãŒæ¯”è¼ƒçš„å¤šããƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãã†ã€‚

[embed]https://github.com/felixc/rexiv2[/embed]

ã“ã®ãƒšãƒ¼ã‚¸ã«å¾“ã£ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ãŸãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚“ã§ã„ãªã„ã“ã¨ã‚’æ€ã„å‡ºã—ãŸã€‚

    # console
    $ cargo init

Cargo.tomlã¨ã„ã†ã‚‚ã®ãŒã§ãã‚‹ã®ã§ã€dependenciedã«ã“ã®Crateã‚’è¨˜è¼‰ã€‚

    [package]
    name = "exif"
    version = "0.1.0"
    authors = ["Katsumata Ryo <katsumata@stores.jp>"]
    edition = "2018"
    
    [dependencies]
    rexiv2 = "0.7.0" // <- ã“ã‚Œ

buildã—ã¦ã¿ã‚‹

    $ cargo run Updating[crates.io](http://crates.io)index Downloaded rexiv2 v0.7.0
    Downloaded gexiv2-sys v1.0.0
    Downloaded num-rational v0.2.1
    Downloaded libc v0.2.45
    Downloaded pkg-config v0.3.14
    Downloaded num-traits v0.2.6
    Downloaded num-integer v0.1.39
    Compiling num-traits v0.2.6
    Compiling libc v0.2.45
    Compiling num-integer v0.1.39
    Compiling pkg-config v0.3.14
    Compiling num-rational v0.2.1
    Compiling gexiv2-sys v1.0.0
    error: failed to run custom build command forgexiv2-sys v1.0.0
    process didn't exit successfully:/Users/ryo/work/ryo/study_rust/exif/target/debug/build/gexiv2-sys-806d287d621f3889/build-script-build(exit code: 101) --- stdout

    The gexiv2 library was not found by pkg-config on your system.Consult the README.md file for suggestions on how to acquire it.--- stderrthread 'main' panicked at '`"pkg-config" "--libs" "--cflags" "gexiv2"` did not exit successfully: exit code: 1--- stderrPackage gexiv2 was not found in the pkg-config search path.Perhaps you should add the directory containing `gexiv2.pc'to the PKG_CONFIG_PATH environment variableNo package 'gexiv2' found', /Users/ryo/.cargo/registry/src/github.com-1ecc6299db9ec823/gexiv2-sys-1.0.0/build.rs:28:13note: Run with `RUST_BACKTRACE=1` for a backtrace.warning: build failed, waiting for other jobs to finish...error: build failed

ã©ã†ã‚„ã‚‰ `gexiv2` ãŒãªã•ãã†ã€‚ã“ã‚Œã¯Rustã®ã‚‚ã®ã˜ã‚ƒãªãã¦ãã‚‚ãã‚‚åˆ¥ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã£ã½ã‹ã£ãŸã®ã§homebrewã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããã†ã ã£ãŸã€‚

    brew install gexiv2==> Installing dependencies for gexiv2: exiv2, pcre and glib==> Installing gexiv2 dependency: exiv2==> Downloading <https://homebrew.bintray.com/bottles/exiv2-0.26.mojave.bottle.1>.######################################################################## 100.0%==> Pouring exiv2-0.26.mojave.bottle.1.tar.gzğŸº /usr/local/Cellar/exiv2/0.26: 55 files, 7.6MB==> Installing gexiv2 dependency: pcre==> Downloading <https://homebrew.bintray.com/bottles/pcre-8.42.mojave.bottle.tar>######################################################################## 100.0%==> Pouring pcre-8.42.mojave.bottle.tar.gzğŸº /usr/local/Cellar/pcre/8.42: 204 files, 5.5MB==> Installing gexiv2 dependency: glib==> Downloading <https://homebrew.bintray.com/bottles/glib-2.58.2.mojave.bottle.t>######################################################################## 100.0%==> Pouring glib-2.58.2.mojave.bottle.tar.gzğŸº /usr/local/Cellar/glib/2.58.2: 435 files, 18.5MB==> Installing gexiv2==> Downloading <https://homebrew.bintray.com/bottles/gexiv2-0.10.9.mojave.bottle>######################################################################## 100.0%==> Pouring gexiv2-0.10.9.mojave.bottle.tar.gzğŸº /usr/local/Cellar/gexiv2/0.10.9: 22 files, 496KB

ã‚ˆã£ã—ã‚ƒã€‚

### ã‚³ãƒ¼ãƒ‰
ã¨ã‚Šã‚ãˆãšãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã¿ã¦ã€æµå„€ã«å¤–ã‚Œã¦ã„ã¦ã‚‚ã¨ã‚Šã‚ãˆãšèª­ã¿è¾¼ã‚ã‚‹ã‚‚ã®ã‚’ä½œã‚‹ã“ã¨ã‚’é ‘å¼µã£ãŸã€‚

    use rexiv2;
    
    fn main() {
    let file = "/Users/ryo/Downloads/Photos/DSC04117.jpg";
    let meta = rexiv2::Metadata::new_from_path(&file).unwrap();
    
    println!("{:?}", meta.get_pixel_width());
    println!("{:?}", meta.get_pixel_height());
    println!("F: {:?}", meta.get_fnumber());
    println!("ISO: {:?}", meta.get_iso_speed());
    println!("{:?}", meta.get_exposure_time());
    }

### å®Ÿè¡Œ
    $ cargo run
    Compiling exif v0.1.0 (/Users/ryo/work/ryo/study_rust/exif)
    Finished dev [unoptimized + debuginfo] target(s) in 0.72s
    Running `target/debug/exif`
    6000
    4000
    F: Some(1.8)
    ISO: Some(320)
    Some(Ratio { numer: 1, denom: 200 })

ãªã‚“ã‹å¤‰ã ã‘ã©ã€ãã‚Œã£ã½ã„ã®ãŒã¨ã‚Œã¦ã„ã‚‹æ°—ãŒã™ã‚‹ï¼ã“ã®è¨˜äº‹ã§ã¯ä¸€æ—¦ã“ã“ã¾ã§ã€‚

### ä»Šå¾Œ
ä»¥ä¸‹ã®äº‹ãŒã§ãã‚‹ã¨è‡ªåˆ†ãŒã‚„ã‚ŠãŸã„ã“ã¨ã«ã¨ã‚Šã‚ãˆãšè¿½ã„ã¤ãã®ã§

- ç”»åƒpathç›´æ›¸ãã—ãŸã®ã‚’å¼•æ•°ã§å–å¾—ã™ã‚‹
- someã¨ã‹ã®ã¨ã“ã‚ã‚’stringã§è¡¨ç¤ºã™ã‚‹
- RatioãŒRatioã§è¡¨ç¤ºã§ãã¦ãªã„ã®ã§stringã§è¡¨ç¤ºã™ã‚‹
- ãƒœãƒ‡ã‚£åã¨ãƒ¬ãƒ³ã‚ºåã‚’å–å¾—ã™ã‚‹
ã“ã®ã‚ãŸã‚Šã‚’ã‚„ã£ã¦ã„ãã¾ã™ã€‚


