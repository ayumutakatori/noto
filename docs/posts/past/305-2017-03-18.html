<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes">
<title>NOTO - Google Cloud Platformを初めて触る</title>
<link rel="stylesheet" href="/public/css/base.css">
    </head>
    <body>
        <h1><a href="/">NOTO</a></h1>

        <div class="content">
            <h2 class="title">Google Cloud Platformを初めて触る</h2>
            <div class="description">
                　Date：2017-03-18 16:59:48 +0900<br />
                　Categories： TECHNOLOGY <br />
            </div>
            <p>google cloud platformの無料枠が増えたというニュースをみてちょっと触ってみることにしました(<a href="https://japan.zdnet.com/article/35097973/">https://japan.zdnet.com/article/35097973/</a>)。</p>
<h3>アカウント登録からインスタンス作成まで</h3>
<p><img class="in_article" src="/public/images/2017/09/58cf1-1hqcknwbz1ivn6a3lfq7p5a.png"><em>まずはサービスのページここの無料トライアルから作成</em></p>
<p><img class="in_article" src="/public/images/2017/09/bb59c-1kxhpbh6xqndv8vvzxwit0w.jpg"><em>利用するための情報を登録していく。</em></p>
<p><img class="in_article" src="/public/images/2017/09/0426f-1kobqf-bcqieumsx5lop1fg.jpg"><em>開始までちょっと時間かかる。</em></p>
<p><img class="in_article" src="/public/images/2017/09/1bdfe-1kixm5lblvk7qx4cq9kg3xa.jpg"><em>管理コンソールが表示される。ちゃんと日本語化されてる</em></p>
<p><img class="in_article" src="/public/images/2017/09/63ad5-1pm2ltbfpg69wdlwhknaffw.jpg"><em>まずはサーバを。AWSで言うEC2</em></p>
<p><img class="in_article" src="/public/images/2017/09/7038d-1ydlj9bi6mvaya6w3o6ngrg.jpg"><em>初めて作るときはここも時間がかかる。</em></p>
<p><img class="in_article" src="/public/images/2017/09/53cc5-1byipuu3egfniilnelebzaw.jpg"><em>画面が表示されたらサーバの設定をしていく。OSイメージの種類</em></p>
<p><img class="in_article" src="/public/images/2017/09/1f4c6-1bog4lx78ire89ewy8bla7a.jpg"><em>こんなのもある。</em></p>
<p><img class="in_article" src="/public/images/2017/09/0a507-1pl30-h58ebxra2unnj0h4w.jpg"><em>設定していく。</em></p>
<p><img class="in_article" src="/public/images/2017/09/89e34-1zyzpttellv6gfuulkr481w.jpg"><em>設定が完了したら「作成」を押す</em></p>
<p><img class="in_article" src="/public/images/2017/09/8e984-1kelhwvarqgtwvi0ceyudpg.jpg"><em>無事にインスタンスが立ち上がりました。</em></p>
<p>ざっと触ってみた感じ。AWSを触ったことがある人であればなんとなく使えそうって言う感じ。日本語ちゃんとなっているし。</p>
<h3>gcloudコマンドのインストール</h3>
<p>gcloudというコマンドが必要なようで、まずそちらをインストール。コマンドは下記の通りで。このコマンドを打つと何回か質問がされますので、全部答えていきます。私は最初なのでとりあえず全部デフォルトっぽいのでセットしました。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ curl https://sdk.cloud.google.com | bash
</span></pre>
<p>次に認証のためのコマンドを実行します。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ gcloud init
</span></pre>
<p>認証しますか？という問いにYで応えるとブラウザが立ち上がり認証を求められます。</p>
<p>Googleアカウントでログイン後に</p>
<p><img class="in_article" src="/public/images/2017/09/1b18d-1bmyxk8vc3hkt_9v5emu5ag.jpg">と出てくるので許可をすると認証が終わります。</p>
<p><img class="in_article" src="/public/images/2017/09/72caa-1mrovvaoenylhhpke0hzlnq.jpg">### compute engine にログイン
ここまで準備が終わったのでcompute engineにログインしてみます。管理コンソールに戻ってcompute engineのインスタンスのところで赤枠部分を選択するとメニューがでてきて「gcloudコマンドを表示」とでます。</p>
<p><img class="in_article" src="/public/images/2017/09/3a62b-1ot_zi_x1-lcsepnpwqzzg.jpg">ここを選択するとコマンドが表示されます。</p>
<p><img class="in_article" src="/public/images/2017/09/6889a-1iajbtwyle4caxl5zbge66a.jpg">これを実行してみる。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ gcloud compute --project &quot;service-account-manager&quot; ssh --zone &quot;asia-northeast1-c&quot; &quot;instance-1&quot;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">WARNING: The public SSH key file for gcloud does not exist.
</span><span style="color:#c0c5ce;">WARNING: The private SSH key file for gcloud does not exist.
</span><span style="color:#c0c5ce;">WARNING: You do not have an SSH key for gcloud.
</span><span style="color:#c0c5ce;">WARNING: [/usr/bin/ssh-keygen] will be executed to generate a key.
</span><span style="color:#c0c5ce;">Generating public/private rsa key pair.
</span><span style="color:#c0c5ce;">Enter passphrase (empty for no passphrase):
</span><span style="color:#c0c5ce;">Enter same passphrase again:
</span><span style="color:#c0c5ce;">Your identification has been saved in /Users/xxx/.ssh/google_compute_engine.
</span><span style="color:#c0c5ce;">Your public key has been saved in /Users/xxx/.ssh/google_compute_engine.pub.
</span><span style="color:#c0c5ce;">The key fingerprint is:
</span><span style="color:#c0c5ce;">The key&#39;s randomart image is:
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">Updating project ssh metadata.../Updated [[https://www.googleapis.com/compute/v1/projects/service-account-manager](https://www.googleapis.com/compute/v1/projects/service-account-manager)].
</span><span style="color:#c0c5ce;">Updating project ssh metadata...done.
</span><span style="color:#c0c5ce;">Warning: Permanently added &#39;compute.00000000000000&#39; (ECDSA) to the list of known hosts.
</span><span style="color:#c0c5ce;">[xxx@instance-1 ~]$
</span></pre>
<p>秘密鍵の指定を特にしていなかったせいか、鍵が自動で作られてログインされた様子。</p>
<p>ちなみに、事前に公開鍵を登録していれば</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ ssh -i &lt;秘密鍵のパス&gt; &lt;user&gt;@&lt;ip or hostname&gt;
</span></pre>
<p>でログイン可能です。</p>
<h3>色々と確認</h3>
<p>ログインできたので軽く確認してみる。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ cat .ssh/authorized_keys
</span></pre>
<p>ここにはさっき追加された公開鍵とインスタンス作成時に追加した公開鍵が追加されていた</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ ls /home
</span></pre>
<p>ユーザーはインスタンス作成時に追加したユーザが2人。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ cat /etc/redhat-release
</span><span style="color:#c0c5ce;">CentOS Linux release 7.3.1611 (Core)
</span></pre>
<p>CentOs 7を選択したのでこれが(2017/03/18時点)</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ sudo cat /etc/ssh/sshd_config ※抜粋
</span><span style="color:#c0c5ce;">PermitRootLogin no
</span><span style="color:#c0c5ce;">PasswordAuthentication no
</span></pre>
<p>sudoパスワードなしで行けてた。怖い。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ yum list installed
</span></pre>
<p>これといってすごい面白いものはなかった。</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">$ systemctl list-units --type=service |cat
</span><span style="color:#c0c5ce;">UNIT LOAD ACTIVE SUB DESCRIPTION
</span><span style="color:#c0c5ce;">acpid.service loaded active running ACPI Event Daemon
</span><span style="color:#c0c5ce;">auditd.service loaded active running Security Auditing Service
</span><span style="color:#c0c5ce;">avahi-daemon.service loaded active running Avahi mDNS/DNS-SD Stack
</span><span style="color:#c0c5ce;">crond.service loaded active running Command Scheduler
</span><span style="color:#c0c5ce;">dbus.service loaded active running D-Bus System Message Bus
</span><span style="color:#c0c5ce;">firewalld.service loaded active running firewalld - dynamic firewall daemon
</span><span style="color:#c0c5ce;">getty@tty1.service loaded active running Getty on tty1
</span><span style="color:#c0c5ce;">google-accounts-daemon.service loaded active running Google Compute Engine Accounts Daemon
</span><span style="color:#c0c5ce;">google-clock-skew-daemon.service loaded active running Google Compute Engine Clock Skew Daemon
</span><span style="color:#c0c5ce;">google-ip-forwarding-daemon.service loaded active running Google Compute Engine IP Forwarding Daemon
</span><span style="color:#c0c5ce;">google-shutdown-scripts.service loaded active exited Google Compute Engine Shutdown Scripts
</span><span style="color:#c0c5ce;">kmod-static-nodes.service loaded active exited Create list of required static device nodes for the current kernel
</span><span style="color:#c0c5ce;">network.service loaded active exited LSB: Bring up/down networking
</span><span style="color:#c0c5ce;">NetworkManager-wait-online.service loaded active exited Network Manager Wait Online
</span><span style="color:#c0c5ce;">NetworkManager.service loaded active running Network Manager
</span><span style="color:#c0c5ce;">ntpd.service loaded active running Network Time Service
</span><span style="color:#c0c5ce;">polkit.service loaded active running Authorization Manager
</span><span style="color:#c0c5ce;">postfix.service loaded active running Postfix Mail Transport Agent
</span><span style="color:#c0c5ce;">rhel-dmesg.service loaded active exited Dump dmesg to /var/log/dmesg
</span><span style="color:#c0c5ce;">rhel-readonly.service loaded active exited Configure read-only root support
</span><span style="color:#c0c5ce;">rsyslog.service loaded active running System Logging Service
</span><span style="color:#c0c5ce;">serial-getty@ttyS0.service loaded active running Serial Getty on ttyS0
</span><span style="color:#c0c5ce;">sshd-keygen.service loaded active exited OpenSSH Server Key Generation
</span><span style="color:#c0c5ce;">sshd.service loaded active running OpenSSH server daemon
</span><span style="color:#c0c5ce;">systemd-fsck-root.service loaded active exited File System Check on Root Device
</span><span style="color:#c0c5ce;">systemd-hwdb-update.service loaded active exited Rebuild Hardware Database
</span><span style="color:#c0c5ce;">systemd-journal-catalog-update.service loaded active exited Rebuild Journal Catalog
</span><span style="color:#c0c5ce;">systemd-journal-flush.service loaded active exited Flush Journal to Persistent Storage
</span><span style="color:#c0c5ce;">systemd-journald.service loaded active running Journal Service
</span><span style="color:#c0c5ce;">systemd-logind.service loaded active running Login Service
</span><span style="color:#c0c5ce;">systemd-random-seed.service loaded active exited Load/Save Random Seed
</span><span style="color:#c0c5ce;">systemd-remount-fs.service loaded active exited Remount Root and Kernel File Systems
</span><span style="color:#c0c5ce;">systemd-sysctl.service loaded active exited Apply Kernel Variables
</span><span style="color:#c0c5ce;">systemd-tmpfiles-setup-dev.service loaded active exited Create Static Device Nodes in /dev
</span><span style="color:#c0c5ce;">systemd-tmpfiles-setup.service loaded active exited Create Volatile Files and Directories
</span><span style="color:#c0c5ce;">systemd-udev-trigger.service loaded active exited udev Coldplug all Devices
</span><span style="color:#c0c5ce;">systemd-udevd.service loaded active running udev Kernel Device Manager
</span><span style="color:#c0c5ce;">systemd-update-done.service loaded active exited Update is Completed
</span><span style="color:#c0c5ce;">systemd-update-utmp.service loaded active exited Update UTMP about System Boot/Shutdown
</span><span style="color:#c0c5ce;">systemd-user-sessions.service loaded active exited Permit User Sessions
</span><span style="color:#c0c5ce;">systemd-vconsole-setup.service loaded active exited Setup Virtual Console
</span><span style="color:#c0c5ce;">tuned.service loaded active running Dynamic System Tuning Daemon
</span><span style="color:#c0c5ce;">yum-cron.service loaded active exited Run automatic yum updates as a cron job
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">LOAD = Reflects whether the unit definition was properly loaded.
</span><span style="color:#c0c5ce;">ACTIVE = The high-level unit activation state, i.e. generalization of SUB.
</span><span style="color:#c0c5ce;">SUB = The low-level unit activation state, values depend on unit type.
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">43 loaded units listed. Pass --all to see loaded but inactive units, too.
</span><span style="color:#c0c5ce;">To show all installed unit files use &#39;systemctl list-unit-files&#39;.
</span></pre>
<p>こんな感じかな。</p>
<p>次回はここにItamaeでサーバ構成を流していこうと思います。</p>

            <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
        <div class="footer">
            <a href="/">TOP</a>
        </div>
    </body>
</html>
